<h1 align="center">Задание по теме Spring Boot</h1>

<details>
 <summary><strong>
  Техническое задание
</strong></summary>

#### ЗАДАНИЕ:

#### Тестовое задание 3:

1. Создать микросервис для работы с сессиями (Spring boot api), использовать mongoDB;
  - В микросервисе должны быть методы создания и получения текущей сессии по логину
  - В сессии должен быть айдишник, логин, которому принадлежит сессия и время открытия сессии
  - Сессия активна до конца текущего дня, когда она была открыта (придумать механизм очистки сессий)
2. Создать стартер, который сможет реализовать следующий функционал:
  - нужна аннотация, для того, что бы обернуть методы, которые будут реализовывать данный функционал
  - аннотация должна применятся к методам
  - одним из обязательных параметров методов, над которыми будет аннотация, должен быть объект, который будет хранить информацию о сессии(id)
  - еще одним их обязательных параметров методов, над которыми будет аннотация, должен быть объект, который содержит в себе логин
  - там где висит аннотация над методом, мы должны сходить в сервис сессий, получить или создать и получить сессию(нам важен только id) и заинжектить в наш параметр метода
  - идентификатор сессии используем только для логирования работы пользователя
  - сделать настройку для стартера как blackList(список логинов, для которых мы не создаём сессии и выкидываем ошибку) и откуда blackList будет подтягиваться, по дефолту из пропертей, но сделать возможность расширяемости, что бы можно было передать другой источник, откуда будет подтягиваться blackList

method example:

@Annotation(blackList = {PropertySourceHandler.class, DataSourceHandler.class})
public void work(Obj obj1, Obj obj2, Obj obj3...){
}
</details>

<details>
 <summary><strong>
  Стек
</strong></summary>

#### При разработке были использованы:

* Java 21
* Gradle 8.5
* Lombok plugin 8.4
* Spring-boot 3.2.4
* Spring-boot-starter-data-mongodb
* Spring-boot-starter-web
* Spring-boot-starter-data-jpa
* Spring-boot-starter-validation
* Mapstruct 1.5.5.Final
* Liquibase
* PostgreSQL
</details>

<details>
 <summary><strong>
  Запуск проекта
</strong></summary>

### Инструкция запуска модуля session

* Это объект, модуль который создает и сохраняет объект сессии в MongoDB.
* Перед запуском необходимо создать базу данных "session" и установить в application.yml в строках 4,5 свои креды.
* Также необходимо установить в строке 12 время для тайминга очистки сессий. По умолчанию он настроен на 00.00.
* Все готово его можно запускать
* Проверить правильность работы модуля можно выполнить запрос по url: http://localhost:8081/sessions
```json
{
    "login":"bean"
}
```
* и получим ответ 
```json
{
    "id": -8694649720637049247,
    "login": "bean",
    "openingTime": "2024-10-23T00:29:20"
}
```
***

### Инструкция для запуска стартера:

* Запустить задачу для стартера можно как из меню gradle так и с помощью `./gradlew -p starter publishToMavenLocal`
* Добавить в build.gradle в dependency своего проекта:

````groovy
dependencies {
  implementation 'ru.clevertec:starter:1.0-SNAPSHOT'
}
````

***

### Инструкция для запуска модуля video:

* основная функциональность модуля описана в репозитории https://github.com/Nikolay1992167/VideoHosting/tree/feature/videohosting. 
* В данном проекте она использована для тестирования аннотации. 
* В сервисе предусмотрено 3 способа указания blacklist: 
* 1. в параметрах аннотации;
* 2. в application.yml в поле black-list;
* 3. с помощью метода класса имплементирующего BlackListHandler и путь к нему необходимо указать в application.yml.

* Добавить в application.yaml модуля video url модуля сессий:

 ````yaml
session:
  aware:
    enabled: true
    url: http://localhost:8081/sessions
````

* Параметры метода должны содержать объект Session для отслеживания сессий, иначе получим исключение с сообщением
* `"Must be a Session object in the parameters"`.
* Большинство исключительных ситуаций обработано.
* Аннотация применена к методам контроллера UserController, так как объект User содержит поле login.
* Проверить можно:
* **POST save | Create new user**
* http://localhost:8080/users
* Request example:
````json
{
  "login": "mono",
  "name": "Elena",
  "email": "elena123@gmail.com"
}
````
* Response example:
````json
{
  "id": 40,
  "login": "mono",
  "name": "Elena",
  "email": "elena123@gmail.com"
}
````
* Так как в методах логируется сущность сессии получим следующий лог:
```
Session(id=2884496324949597136, login=mono, openingTime=2024-10-23T21:39:13)
```
***

</details>

<details>
 <summary><strong>
  Тесты
</strong></summary>

* Тесты не реализованы.
</details>